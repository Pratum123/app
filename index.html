<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8">
  <title>ЁЯУШ рд╡рд┐рд╖рдп рдЪрдпрди</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: 'Segoe UI', sans-serif;
      background: #f4f6fb;
      margin: 0;
      padding: 0;
    }

    header {
      background: #3949ab;
      color: white;
      padding: 20px;
      font-size: 24px;
      text-align: center;
    }

    .container {
      max-width: 500px;
      margin: 30px auto;
      background: white;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }

    h1 {
      text-align: center;
      color: #3949ab;
      font-size: 22px;
    }

    select, input, button {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border-radius: 6px;
      border: 1px solid #ccc;
      font-size: 16px;
      box-sizing: border-box;
    }

    .btn {
      background: #3949ab;
      color: white;
      font-weight: bold;
      border: none;
      cursor: pointer;
    }

    .section {
      margin-bottom: 30px;
    }

    h3 {
      font-size: 18px;
      color: #333;
      margin-bottom: 10px;
    }
  </style>
</head>
<body>

<header>ЁЯУШ Quiz App</header>

<div class="container">
  <h1>ЁЯУШ рд╡рд┐рд╖рдп рдФрд░ рдЙрдкрд╡рд┐рд╖рдп рдЪрдпрди</h1>

  <!-- рд╡рд┐рд╖рдп рдЪрдпрди -->
  <div class="section">
    <label><strong>рдореБрдЦреНрдп рд╡рд┐рд╖рдп:</strong></label>
    <select id="mainSubject" onchange="populateSubSubjects()">
      <option value="">-- рд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ --</option>
    </select>

    <label><strong>рдЙрдкрд╡рд┐рд╖рдп:</strong></label>
    <select id="subSubject">
      <option value="">-- рдЙрдкрд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ --</option>
    </select>

    <button class="btn" onclick="proceedToAction()">ЁЯСЙ рдЖрдЧреЗ рдмрдврд╝реЗрдВ</button>
  </div>

  <!-- рдирдпрд╛ рд╡рд┐рд╖рдп рдЬреЛрдбрд╝реЗрдВ -->
  <div class="section">
    <h3>тЮХ рдирдпрд╛ рд╡рд┐рд╖рдп рдЬреЛрдбрд╝реЗрдВ</h3>
    <input id="newMain" placeholder="рдореБрдЦреНрдп рд╡рд┐рд╖рдп (рдЬреИрд╕реЗ: Economics)">
    <input id="newSubs" placeholder="рдЙрдкрд╡рд┐рд╖рдп (рдХреЙрдорд╛ рд╕реЗ рдЕрд▓рдЧ рдХрд░реЗрдВ)">
    <button class="btn" onclick="addNewSubject()">ЁЯТ╛ рдЬреЛрдбрд╝реЗрдВ</button>
  </div>

  <!-- рдирдпрд╛ рдЙрдкрд╡рд┐рд╖рдп рдЬреЛрдбрд╝реЗрдВ -->
  <div class="section">
    <h3>тЮХ рдЙрдкрд╡рд┐рд╖рдп рдЬреЛрдбрд╝реЗрдВ</h3>
    <select id="addSubMain">
      <option value="">-- рд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ --</option>
    </select>
    <input id="newSubInput" placeholder="рдирдпрд╛ рдЙрдкрд╡рд┐рд╖рдп (рдЬреИрд╕реЗ: Growth)">
    <button class="btn" onclick="addNewSub()">тЮХ рдЙрдкрд╡рд┐рд╖рдп рдЬреЛрдбрд╝реЗрдВ</button>
  </div>

  <!-- рдЙрдкрд╡рд┐рд╖рдп рдкреНрд░рдмрдВрдзрди -->
  <div class="section">
    <h3>ЁЯЫая╕П рдЙрдкрд╡рд┐рд╖рдп рдкреНрд░рдмрдВрдзрди</h3>
    <select id="manageMain" onchange="populateSubList()">
      <option value="">-- рд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ --</option>
    </select>
    <select id="subList"></select>
    <button class="btn" onclick="deleteSub()">ЁЯЧСя╕П рдЙрдкрд╡рд┐рд╖рдп рд╣рдЯрд╛рдПрдВ</button>
  </div>

  <!-- Export/Import рд╕реЗрдХреНрд╢рди -->
  <div class="section">
    <h3>ЁЯУБ LocalStorage Backup</h3>
    <button class="btn" onclick="exportData()">ЁЯТ╛ Export Data</button>
    <input type="file" id="importFile" accept=".json" onchange="importData()" style="margin-top:10px;">
  </div>
</div>

<script>
  const subjects = {
    economics: ["Micro", "Macro"],
    history: ["Ancient", "Medieval", "Modern"],
    science: ["Physics", "Chemistry", "Biology"]
  };

  const stored = JSON.parse(localStorage.getItem("quiz_subjects") || "{}");
  Object.assign(subjects, stored);

  function capitalize(str) {
    return str.charAt(0).toUpperCase() + str.slice(1);
  }

  function populateDropdowns() {
    const main = document.getElementById("mainSubject");
    const manage = document.getElementById("manageMain");
    main.innerHTML = '<option value="">-- рд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ --</option>';
    manage.innerHTML = '<option value="">-- рд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ --</option>';

    for (let key in subjects) {
      const opt1 = new Option(capitalize(key), key);
      const opt2 = new Option(capitalize(key), key);
      main.appendChild(opt1);
      manage.appendChild(opt2);
    }
  }

  function populateAddSubMain() {
    const addMain = document.getElementById("addSubMain");
    addMain.innerHTML = '<option value="">-- рд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ --</option>';
    for (let key in subjects) {
      addMain.appendChild(new Option(capitalize(key), key));
    }
  }

  function populateSubSubjects() {
    const subject = document.getElementById("mainSubject").value;
    const subs = subjects[subject] || [];
    const subSelect = document.getElementById("subSubject");
    subSelect.innerHTML = '<option value="">-- рдЙрдкрд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ --</option>';
    subs.forEach(sub => {
      subSelect.appendChild(new Option(sub, sub));
    });
  }

  function addNewSubject() {
    const newMain = document.getElementById("newMain").value.trim().toLowerCase();
    const newSubs = document.getElementById("newSubs").value.split(',').map(s => s.trim()).filter(Boolean);
    if (!newMain || newSubs.length === 0) {
      alert("тЭЧ рдХреГрдкрдпрд╛ рд╡рд┐рд╖рдп рдФрд░ рдЙрдкрд╡рд┐рд╖рдп рднрд░реЗрдВ");
      return;
    }
    subjects[newMain] = newSubs;
    localStorage.setItem("quiz_subjects", JSON.stringify(subjects));
    document.getElementById("newMain").value = "";
    document.getElementById("newSubs").value = "";
    populateDropdowns();
    populateAddSubMain();
    alert("тЬЕ рдирдпрд╛ рд╡рд┐рд╖рдп рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛!");
  }

  function addNewSub() {
    const main = document.getElementById("addSubMain").value;
    const newSub = document.getElementById("newSubInput").value.trim();
    if (!main || !newSub) {
      alert("тЭЧ рдХреГрдкрдпрд╛ рд╡рд┐рд╖рдп рдФрд░ рдирдпрд╛ рдЙрдкрд╡рд┐рд╖рдп рднрд░реЗрдВ");
      return;
    }
    if (!subjects[main].includes(newSub)) {
      subjects[main].push(newSub);
      localStorage.setItem("quiz_subjects", JSON.stringify(subjects));
      document.getElementById("newSubInput").value = "";
      populateSubSubjects();
      populateSubList();
      alert("тЬЕ рдирдпрд╛ рдЙрдкрд╡рд┐рд╖рдп рдЬреЛрдбрд╝рд╛ рдЧрдпрд╛!");
    } else {
      alert("тЪая╕П рдЙрдкрд╡рд┐рд╖рдп рдкрд╣рд▓реЗ рд╕реЗ рдореМрдЬреВрдж рд╣реИ!");
    }
  }

  function populateSubList() {
    const selected = document.getElementById("manageMain").value;
    const list = document.getElementById("subList");
    list.innerHTML = "";
    if (subjects[selected]) {
      subjects[selected].forEach(sub => {
        list.appendChild(new Option(sub, sub));
      });
    }
  }

  function deleteSub() {
    const subject = document.getElementById("manageMain").value;
    const sub = document.getElementById("subList").value;
    if (subject && sub) {
      subjects[subject] = subjects[subject].filter(s => s !== sub);
      localStorage.setItem("quiz_subjects", JSON.stringify(subjects));
      populateSubList();
      populateSubSubjects();
      alert("ЁЯЧСя╕П рдЙрдкрд╡рд┐рд╖рдп рд╣рдЯрд╛ рджрд┐рдпрд╛ рдЧрдпрд╛!");
    }
  }

  function proceedToAction() {
    const main = document.getElementById("mainSubject").value;
    const sub = document.getElementById("subSubject").value;
    if (!main || !sub) {
      alert("тЪая╕П рдХреГрдкрдпрд╛ рд╡рд┐рд╖рдп рдФрд░ рдЙрдкрд╡рд┐рд╖рдп рдЪреБрдиреЗрдВ!");
      return;
    }
    localStorage.setItem("selectedMain", main);
    localStorage.setItem("selectedSub", sub);
    window.location.href = "action.html";
  }

  function exportData() {
    const data = {
      subjects,
      main: localStorage.getItem("selectedMain"),
      sub: localStorage.getItem("selectedSub"),
      quizData: {}
    };

    for (let key in localStorage) {
      if (key.startsWith("quiz_")) {
        data.quizData[key] = JSON.parse(localStorage.getItem(key));
      }
    }

    const blob = new Blob([JSON.stringify(data, null, 2)], { type: "application/json" });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "quiz_backup.json";
    a.click();
  }

  function importData() {
    const file = document.getElementById("importFile").files[0];
    if (!file) return;

    const reader = new FileReader();
    reader.onload = function(e) {
      const data = JSON.parse(e.target.result);

      if (data.subjects) {
        localStorage.setItem("quiz_subjects", JSON.stringify(data.subjects));
      }
      if (data.main) {
        localStorage.setItem("selectedMain", data.main);
      }
      if (data.sub) {
        localStorage.setItem("selectedSub", data.sub);
      }
      if (data.quizData) {
        for (let key in data.quizData) {
          localStorage.setItem(key, JSON.stringify(data.quizData[key]));
        }
      }

      alert("тЬЕ рдбреЗрдЯрд╛ рд╕рдлрд▓рддрд╛рдкреВрд░реНрд╡рдХ рдЖрдпрд╛рдд рд╣реБрдЖ!");
      location.reload();
    };
    reader.readAsText(file);
  }

  window.onload = () => {
    populateDropdowns();
    populateAddSubMain();
  };
</script>

</body>
</html>
